import{r as y,o as q,_ as G,u as S,a as x,c as T,t as m,b as p,w as R,v as B,d as I,e as P,f as W,g as M,h as V,i as A}from"./framework.BZaulDZr.js";function F(e){return e?`/auth/login/${e}`:"/auth/login"}var w="/",z=(e,t)=>(e.endsWith(w)&&(e=e.slice(0,-1)),t.startsWith(w)||(t=w+t),e+t),v=(e,t,s)=>{let r=e.pathname===w?t:z(e.pathname,t),a=new globalThis.URL(r,e);if(s)for(let[n,o]of Object.entries(se(s)))if(o&&typeof o=="object"&&!Array.isArray(o))for(let[l,f]of Object.entries(o))a.searchParams.set(`${n}[${l}]`,String(f));else a.searchParams.set(n,o);return a};function K(e){return typeof e!="object"||!e?!1:"headers"in e&&"ok"in e&&"json"in e&&typeof e.json=="function"&&"text"in e&&typeof e.json=="function"}async function Y(e){var t;if(!(typeof e!="object"||!e)){if(K(e)){let s=(t=e.headers.get("Content-Type"))==null?void 0:t.toLowerCase();if(s!=null&&s.startsWith("application/json")||s!=null&&s.startsWith("application/health+json")){let r=await e.json();if(!e.ok||"errors"in r)throw r;return"data"in r?r.data:r}if(s!=null&&s.startsWith("text/html")||s!=null&&s.startsWith("text/plain")){let r=await e.text();if(!e.ok)throw r;return r}return e}if("errors"in e)throw e;return"data"in e?e.data:e}}var k=async(e,t,s=globalThis.fetch)=>(t.headers=typeof t.headers=="object"&&!Array.isArray(t.headers)?t.headers:{},s(e,t).then(r=>Y(r).catch(a=>{let n={errors:a&&typeof a=="object"&&"errors"in a?a.errors:a,response:r};return a&&typeof a=="object"&&"data"in a&&(n.data=a.data),Promise.reject(n)}))),H=()=>{let e=null;return{get:async()=>e,set:async t=>{e=t}}},Q={msRefreshBeforeExpires:3e4,autoRefresh:!0},X=2**31-1,Z=(e="cookie",t={})=>s=>{let r={...Q,...t},a=null,n=null,o=r.storage??H(),l=async()=>o.set({access_token:null,refresh_token:null,expires:null,expires_at:null}),f=async()=>{try{await a}finally{a=null}},c=async()=>{let i=await o.get();return a||!(i!=null&&i.expires_at)||i.expires_at<new Date().getTime()+r.msRefreshBeforeExpires&&j().catch(u=>{}),f()},h=async i=>{let u=i.expires??0;i.expires_at=new Date().getTime()+u,await o.set(i),r.autoRefresh&&u>r.msRefreshBeforeExpires&&u<X&&(n&&clearTimeout(n),n=setTimeout(()=>{n=null,j().catch(d=>{})},u-r.msRefreshBeforeExpires))},j=async()=>(a=(async()=>{let i=await o.get();await l();let u={method:"POST",headers:{"Content-Type":"application/json"}};"credentials"in r&&(u.credentials=r.credentials);let d={mode:e};e==="json"&&(i!=null&&i.refresh_token)&&(d.refresh_token=i.refresh_token),u.body=JSON.stringify(d);let g=v(s.url,"/auth/refresh");return k(g.toString(),u,s.globals.fetch).then(_=>h(_).then(()=>_))})(),a);return{refresh:j,async login(i,u,d={}){await l();let g={email:i,password:u};"otp"in d&&(g.otp=d.otp),g.mode=d.mode??e;let _=F(d.provider),L=v(s.url,_),C={method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(g)};"credentials"in r&&(C.credentials=r.credentials);let $=await k(L.toString(),C,s.globals.fetch);return await h($),$},async logout(){let i=await o.get(),u={method:"POST",headers:{"Content-Type":"application/json"}};"credentials"in r&&(u.credentials=r.credentials);let d={mode:e};e==="json"&&(i!=null&&i.refresh_token)&&(d.refresh_token=i.refresh_token),u.body=JSON.stringify(d);let g=v(s.url,"/auth/logout");await k(g.toString(),u,s.globals.fetch),this.stopRefreshing(),await l()},stopRefreshing(){n&&clearTimeout(n)},async getToken(){var i;return await c().catch(()=>{}),((i=await o.get())==null?void 0:i.access_token)??null},async setToken(i){return o.set({access_token:i,refresh_token:null,expires:null,expires_at:null})}}},E={fetch:globalThis.fetch,WebSocket:globalThis.WebSocket,URL:globalThis.URL,logger:globalThis.console},ee=(e,t={})=>{let s=t.globals?{...E,...t.globals}:E;return{globals:s,url:new s.URL(e),with(r){return{...this,...r(this)}}}};function J(e){return["directus_access","directus_activity","directus_collections","directus_comments","directus_fields","directus_files","directus_folders","directus_migrations","directus_permissions","directus_policies","directus_presets","directus_relations","directus_revisions","directus_roles","directus_sessions","directus_settings","directus_users","directus_webhooks","directus_dashboards","directus_panels","directus_notifications","directus_shares","directus_flows","directus_operations","directus_translations","directus_versions","directus_extensions"].includes(e)}var _e=(e,t,s)=>()=>{let r=String(e);if(J(r))throw new Error("Cannot use createItem for core collections");return{path:`/items/${r}`,params:s??{},body:JSON.stringify(t),method:"POST"}},te=e=>{let t=(s,r=[])=>{if(typeof s=="object"){let a=[];for(let n in s){let o=s[n]??[];if(Array.isArray(o))for(let l of o)a.push(t(l,[...r,n]));else if(typeof o=="object")for(let l of Object.keys(o)){let f=o[l];for(let c of f)a.push(t(c,[...r,`${n}:${l}`]))}}return a.flatMap(n=>n)}return[...r,String(s)].join(".")};return e.flatMap(s=>t(s))},se=e=>{let t={};Array.isArray(e.fields)&&e.fields.length>0&&(t.fields=te(e.fields).join(",")),e.filter&&Object.keys(e.filter).length>0&&(t.filter=JSON.stringify(e.filter)),e.search&&(t.search=e.search),"sort"in e&&e.sort&&(t.sort=typeof e.sort=="string"?e.sort:e.sort.join(",")),typeof e.limit=="number"&&e.limit>=-1&&(t.limit=String(e.limit)),typeof e.offset=="number"&&e.offset>=0&&(t.offset=String(e.offset)),typeof e.page=="number"&&e.page>=1&&(t.page=String(e.page)),e.deep&&Object.keys(e.deep).length>0&&(t.deep=JSON.stringify(e.deep)),e.alias&&Object.keys(e.alias).length>0&&(t.alias=JSON.stringify(e.alias)),e.aggregate&&Object.keys(e.aggregate).length>0&&(t.aggregate=JSON.stringify(e.aggregate)),e.groupBy&&e.groupBy.length>0&&(t.groupBy=e.groupBy.join(","));for(let[s,r]of Object.entries(e))s in t||(typeof r=="string"||typeof r=="number"||typeof r=="boolean"?t[s]=String(r):t[s]=JSON.stringify(r));return t},O=(e,t)=>{if(e.length===0)throw new Error(t)},U=(e,t)=>{if(J(String(e)))throw new Error(t)},be=(e,t)=>()=>(O(String(e),"Collection cannot be empty"),U(e,"Cannot use readItems for core collections"),{path:`/items/${e}`,params:t??{},method:"GET"}),we=(e,t,s)=>()=>(O(String(e),"Collection cannot be empty"),U(e,"Cannot use readItem for core collections"),O(String(t),"Key cannot be empty"),{path:`/items/${e}/${t}`,params:s??{},method:"GET"}),D=e=>()=>({path:"/users/me",params:e??{},method:"GET"}),re=(e,t,s={})=>()=>({path:"/users/register",method:"POST",body:JSON.stringify({email:e,password:t,...s})}),ae={},oe=(e={})=>t=>{let s={...ae,...e};return{async request(r){let a=r();if(a.headers||(a.headers={}),"Content-Type"in a.headers?a.headers["Content-Type"]==="multipart/form-data"&&delete a.headers["Content-Type"]:a.headers["Content-Type"]="application/json","getToken"in this&&!("Authorization"in a.headers)){let f=await this.getToken();f&&(a.headers.Authorization=`Bearer ${f}`)}let n=v(t.url,a.path,a.params),o={method:a.method??"GET",headers:a.headers??{}};"credentials"in s&&(o.credentials=s.credentials),a.body&&(o.body=a.body),a.onRequest&&(o=await a.onRequest(o)),s.onRequest&&(o=await s.onRequest(o));let l=await k(n.toString(),o,t.globals.fetch);return"onResponse"in a&&(l=await a.onResponse(l,o)),"onResponse"in e&&(l=await e.onResponse(l,o)),l}}};const b=ee("https://schooldb.chromatone.center/").with(Z("cookie",{credentials:"include",autoRefresh:!0})).with(oe({credentials:"include"})),N=y(null);function ne(){return q(async()=>{b.refresh(),await b.getToken()&&(N.value=await b.request(D()))}),{user:N,userDB:b}}const ie={key:0,class:"p-4 max-w-80"},le={class:"text-2xl"},ue={class:"p-2 border-2",type:"submit"},ce={class:"flex gap-1"},de={__name:"AuthForm",setup(e){const t=y(""),s=y(""),r=y(!1),a=y(!1),{user:n,userDB:o}=ne();async function l(){r.value?(await o.request(re(t.value,s.value)),a.value=!0):(await o.login(t.value,s.value),n.value=await o.request(D()))}return(f,c)=>S(n)?(x(),T("div",ie,m(S(n)),1)):(x(),T("form",{key:1,class:"flex flex-col gap-4",onSubmit:c[3]||(c[3]=I(h=>l(),["prevent","stop"]))},[p("h2",le,m(r.value?"Sign Up":"Sign In"),1),R(p("input",{type:"email","onUpdate:modelValue":c[0]||(c[0]=h=>t.value=h),placeholder:"Your email"},null,512),[[B,t.value]]),R(p("input",{type:"password","onUpdate:modelValue":c[1]||(c[1]=h=>s.value=h),placeholder:"Your password"},null,512),[[B,s.value]]),p("button",ue,m(r.value?"REGISTER":"LOGIN"),1),p("div",ce,[c[4]||(c[4]=p("div",{class:"op-30"},"Don't have an account?",-1)),p("a",{class:"cursor-pointer underline",onClick:c[2]||(c[2]=h=>r.value=!r.value)},m(r.value?"Login":"Register"),1)])],32))}},pe=G(de,[["__scopeId","data-v-be2a5910"]]),fe={class:"flex flex-col p-4 w-full items-center h-full justify-center relative"},he={key:0,class:"op-50",href:"/"},ge={class:"text-4xl"},ye={__name:"Layout",setup(e){const{frontmatter:t}=P(),s=y(!1);return(r,a)=>{const n=W("content");return x(),T("div",fe,[S(t).home?M("",!0):(x(),T("a",he,"Creative Multimedia School")),p("button",{class:"op-50 absolute top-4 right-4 z-100 text-2xl p-2 rounded-full bg-dark-400",onClick:a[0]||(a[0]=o=>s.value=!s.value)},a[1]||(a[1]=[p("div",{class:"i-la-user"},null,-1)])),R(A(pe,{class:"bg-dark-300 p-4 rounded-xl shadow-xl absolute top-4 right-4 z-90"},null,512),[[V,s.value]]),p("h1",ge,m(S(t).title),1),A(n,{class:"prose"})])}}},ve={Layout:ye,enhanceApp({app:e,router:t,siteData:s}){}};export{oe as F,be as G,we as K,ve as R,_e as U,ee as l,ne as u};
