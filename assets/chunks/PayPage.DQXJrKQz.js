import{$ as _,a as r,c as i,b as e,t as n,a0 as C,u as o,G as H,n as $,r as P,e as E,f as M,v as U,d as b,g as k,h as V,F as G,C as q,Z as A}from"./framework.BqMAUCVn.js";import{u as D,c as B,U as N,K as Q,G as R}from"./theme.n0hWwsmd.js";import{u as T}from"./useHash.DWl5Tp0E.js";import{Q as z}from"./qrcode.vue.esm.CnTCufdv.js";import{f as F}from"./format.CHl3EdWp.js";const K={class:"flex flex-wrap gap-2"},L={class:"font-bold"},j={class:"uppercase"},O={class:"flex flex-wrap gap-2 items-center"},Z={class:"font-bold"},I={class:"flex flex-wrap gap-2"},J={class:"font-bold"},W={class:"p-0"},X={class:"text-start op-50"},Y={class:"p-0"},S={__name:"PaymentSlip",props:{payment:{type:Object}},setup(s){const{go:p}=_();return(y,l)=>{var c,f,v,u,x,m,g,a,t,d,h,w;return r(),i("div",{class:"flex flex-col gap-2 bg-light-600 m-2 p-4 shadow rounded-lg my-0 font-mono text-sm cursor-pointer hover-brightness-120 transition hover-shadow-xl",onClick:l[0]||(l[0]=re=>o(p)(`/payments/#${s.payment.id}`))},[e("div",K,[e("div",L,n(((c=s.payment.student)==null?void 0:c.first_name)||"---")+" "+n(((f=s.payment.student)==null?void 0:f.last_name)||"---"),1),l[1]||(l[1]=e("div",{class:"flex-1"},null,-1)),e("div",j,n(((m=(x=(u=(v=s.payment)==null?void 0:v.enrollment)==null?void 0:u.course)==null?void 0:x.program)==null?void 0:m.slug)||"---")+" "+n(((t=(a=(g=s.payment)==null?void 0:g.enrollment)==null?void 0:a.course)==null?void 0:t.level)||"---"),1)]),e("div",O,[e("div",Z,n(s.payment.total)+" THB",1),l[2]||(l[2]=e("div",{class:"flex-1"},null,-1)),e("div",{class:"py-1 rounded-lg px-2",style:C({backgroundColor:s.payment.status=="paid"?"lightgreen":s.payment.status=="pending"?"yellow":"lightgray"})},n(s.payment.status),5)]),e("div",I,[e("div",J,n(o(F)(s.payment.date_created,"HH:mm EEE dd MMM yyyy")),1),l[3]||(l[3]=e("div",{class:"flex-1"},null,-1)),e("div",W,n((d=s.payment.user_created)==null?void 0:d.first_name)+" "+n((h=s.payment.user_created)==null?void 0:h.last_name),1)]),e("div",X,n((w=s.payment)==null?void 0:w.id),1),e("div",Y,[H(y.$slots,"default")])])}}},ee={key:0,class:"py-4"},te={key:1,class:"max-w-45ch"},se={class:"flex flex-col gap-2"},ae={class:"flex items-center gap-2"},le={key:1,class:"my-8 flex flex-col gap-4"},ne={key:2,class:"my-4"},oe={key:3,class:"flex flex-col gap-2"},pe={__name:"PayPage",setup(s){const{user:p,userDB:y}=D(),l=$(()=>{var a;return((a=p.value)==null?void 0:a.role)=="f77dcad0-2c27-4754-92da-4742fac1b252"}),c=P(2400),{go:f}=_();async function v(){let{id:a}=await y.request(N("payments",{total:c.value,status:"paid"}));f(`/payments/#${a}`)}const u=T(),x=$(()=>{var a;return`https://school.chromatone.center/payments/#${(a=m.value)==null?void 0:a.id}`}),m=B(async()=>await y.request(Q("payments",u.value,{fields:["*","student.first_name","student.last_name","user_created.*","enrollment.course.level","enrollment.course.program.slug"]}))),g=B(async()=>p.value&&await y.request(R("payments",{fields:["*","student.*","enrollment.*","user_created.*","enrollment.course.level","enrollment.course.program.slug"]})));return(a,t)=>o(p)?(r(),i("div",te,[!o(u)&&l.value?(r(),i("form",{key:0,class:"flex flex-col gap-8 p-4",onSubmit:t[1]||(t[1]=E(d=>v(),["prevent"]))},[t[4]||(t[4]=e("div",{class:"text-2xl"},"Accept payment",-1)),e("div",se,[t[3]||(t[3]=e("div",{class:"op-75"},"Enter amount paid",-1)),e("div",ae,[M(e("input",{class:"p-2 rounded-xl",id:"thb",type:"number","onUpdate:modelValue":t[0]||(t[0]=d=>c.value=d)},null,512),[[U,c.value]]),t[2]||(t[2]=e("label",{class:"ml-2",for:"thb"},"THB",-1))])]),t[5]||(t[5]=e("button",{class:"w-full bg-orange-500 hover-bg-orange-300 transition p-4 rounded-xl font-bold text-xl",type:"submit"},"Submit Payment",-1))],32)):b("",!0),o(m)?(r(),i("div",le,[t[6]||(t[6]=e("a",{class:"p-2 bg-light-400 font-bold shadow rounded-xl",href:"/payments/#"},"Go back to payments list",-1)),k(S,{payment:o(m)},{default:V(()=>[k(z,{class:"w-full rounded mx-auto mt-4",value:x.value,size:"auto",level:"H","render-as":"svg"},null,8,["value"])]),_:1},8,["payment"]),t[7]||(t[7]=e("div",{class:"op-75 text-xl m-4"},"Share this QR code and/or URL for the student to provide to the teacher at the class",-1))])):b("",!0),o(u)&&!o(m)?(r(),i("div",ne,t[8]||(t[8]=[e("div",{class:"i-la-spinner animate-spin text-4xl"},null,-1)]))):b("",!0),o(u)?b("",!0):(r(),i("div",oe,[t[9]||(t[9]=e("div",{class:"text-xl font-bold"},"All payments",-1)),(r(!0),i(G,null,q(o(g),d=>(r(),A(S,{payment:d,key:d.id},null,8,["payment"]))),128))]))])):(r(),i("div",ee,"Please, login to see payments."))}};export{pe as default};
